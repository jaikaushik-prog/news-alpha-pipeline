<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wall Street Club - News Analyser</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Wall Street Club Navy Theme */
            --bg-primary: #0a1628;
            --bg-secondary: #0f1d32;
            --bg-card: #152238;
            --bg-hover: #1a2d4a;
            --accent-teal: #4fd1c5;
            --accent-silver: #a0aec0;
            --accent-green: #48bb78;
            --accent-red: #fc8181;
            --accent-gold: #d4af37;
            --accent-blue: #63b3ed;
            --text-primary: #f7fafc;
            --text-secondary: #a0aec0;
            --text-muted: #718096;
            --border: #2d3e5f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Header - Wall Street Club Style */
        .header {
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-silver), #fff);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .logo-icon svg {
            width: 32px;
            height: 32px;
            fill: var(--bg-primary);
        }

        .logo-text h1 {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 0.02em;
        }

        .logo-text span {
            font-size: 0.7rem;
            color: var(--accent-teal);
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: var(--accent-teal);
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 2rem 0 3rem;
        }

        .hero h2 {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .hero p {
            color: var(--text-secondary);
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto 1.5rem;
        }

        .hero .highlight {
            color: var(--accent-teal);
        }

        /* Control Bar */
        .control-bar {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-teal), #38b2ac);
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(79, 209, 197, 0.3);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            border-color: var(--accent-teal);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .card-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(79, 209, 197, 0.03);
        }

        .card-title {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1.125rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Stats Row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-teal), var(--accent-blue));
        }

        .stat-value {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .stat-positive {
            color: var(--accent-green);
        }

        .stat-negative {
            color: var(--accent-red);
        }

        /* Main Layout */
        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .nav-links {
                display: none;
            }
        }

        /* Regime Badge */
        .regime-badge {
            padding: 0.375rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .regime-bullish {
            background: rgba(72, 187, 120, 0.15);
            color: var(--accent-green);
            border: 1px solid rgba(72, 187, 120, 0.3);
        }

        .regime-bearish {
            background: rgba(252, 129, 129, 0.15);
            color: var(--accent-red);
            border: 1px solid rgba(252, 129, 129, 0.3);
        }

        .regime-neutral {
            background: rgba(160, 174, 192, 0.15);
            color: var(--text-secondary);
            border: 1px solid rgba(160, 174, 192, 0.3);
        }

        /* Sector Table */
        .sector-table {
            width: 100%;
            border-collapse: collapse;
        }

        .sector-table th {
            text-align: left;
            padding: 0.75rem;
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border-bottom: 1px solid var(--border);
        }

        .sector-table td {
            padding: 1rem 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .sector-table tr:hover {
            background: var(--bg-hover);
        }

        .sector-table tr:last-child td {
            border-bottom: none;
        }

        .sector-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Signal Pills */
        .signal-pill {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .signal-long {
            background: rgba(72, 187, 120, 0.15);
            color: var(--accent-green);
        }

        .signal-short {
            background: rgba(252, 129, 129, 0.15);
            color: var(--accent-red);
        }

        .signal-hold {
            background: rgba(160, 174, 192, 0.15);
            color: var(--text-secondary);
        }

        /* Conviction Dots */
        .conviction {
            display: flex;
            gap: 4px;
        }

        .conviction-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
        }

        .conviction-dot.active {
            background: var(--accent-gold);
        }

        /* Score Bar */
        .score-bar {
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            overflow: hidden;
            width: 60px;
        }

        .score-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }

        .score-fill.positive {
            background: var(--accent-green);
        }

        .score-fill.negative {
            background: var(--accent-red);
        }

        /* Recommendations Panel */
        .recommendations-card {
            height: fit-content;
        }

        .rec-section {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
        }

        .rec-section:last-child {
            margin-bottom: 0;
        }

        .rec-title {
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }

        .rec-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .rec-chip {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .rec-chip.long {
            background: rgba(72, 187, 120, 0.15);
            color: var(--accent-green);
        }

        .rec-chip.short {
            background: rgba(252, 129, 129, 0.15);
            color: var(--accent-red);
        }

        .rec-chip.high {
            background: rgba(212, 175, 55, 0.15);
            color: var(--accent-gold);
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-teal);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.75rem;
            border-top: 1px solid var(--border);
            margin-top: 3rem;
        }

        .footer a {
            color: var(--accent-teal);
            text-decoration: none;
        }

        /* Word Cloud */
        /* Word Cloud */
        .word-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
            padding: 2rem;
            height: 300px;
            overflow-y: auto;
            align-content: center;
            background: linear-gradient(180deg, rgba(26, 32, 44, 0) 0%, rgba(0, 0, 0, 0.2) 100%);
            border-radius: 0 0 8px 8px;
        }

        .cloud-tag {
            display: inline-block;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            padding: 0.4rem 0.8rem;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            letter-spacing: 0.03em;
            font-weight: 600;
        }

        .cloud-tag:hover {
            color: #fff !important;
            transform: scale(1.2) translateY(-3px);
            text-shadow: 0 0 12px currentColor, 0 0 20px currentColor;
            z-index: 10;
        }

        /* Sector Heatmap - Professional Gradient Style */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            padding: 1rem;
        }

        .heatmap-cell {
            padding: 1.25rem 0.75rem;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .heatmap-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            pointer-events: none;
        }

        .heatmap-cell:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .heatmap-cell .sector-name {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            opacity: 0.9;
            margin-bottom: 0.25rem;
        }

        .heatmap-cell .sentiment-value {
            font-size: 1.5rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Heatmap color classes */
        .heatmap-strong-bull {
            background: linear-gradient(135deg, #059669 0%, #10B981 100%);
            color: #fff;
        }

        .heatmap-bull {
            background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
            color: #fff;
        }

        .heatmap-neutral {
            background: linear-gradient(135deg, #374151 0%, #4B5563 100%);
            color: #9CA3AF;
        }

        .heatmap-bear {
            background: linear-gradient(135deg, #EF4444 0%, #F87171 100%);
            color: #fff;
        }

        .heatmap-strong-bear {
            background: linear-gradient(135deg, #DC2626 0%, #EF4444 100%);
            color: #fff;
        }

        /* News Timeline */
        .news-timeline {
            max-height: 350px;
            overflow-y: auto;
        }

        .news-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        .news-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-text {
            font-size: 0.9rem;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .news-sentiment {
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 500;
        }

        .news-sentiment.positive {
            background: rgba(72, 187, 120, 0.2);
            color: var(--accent-green);
        }

        .news-sentiment.negative {
            background: rgba(245, 101, 101, 0.2);
            color: var(--accent-red);
        }

        .news-sentiment.neutral {
            background: rgba(160, 174, 192, 0.2);
            color: var(--text-muted);
        }

        /* Top Stocks */
        .stock-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        .stock-item:last-child {
            border-bottom: none;
        }

        .stock-item:hover {
            background: var(--bg-hover);
        }

        .stock-info {
            display: flex;
            flex-direction: column;
        }

        .stock-symbol {
            font-weight: 600;
            color: var(--text-primary);
        }

        .stock-name {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .stock-metrics {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .stock-sentiment {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .stock-mentions {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon" style="background: none; padding: 0;">
                <img src="https://www.wallstreetbitsp.org/images/wsc-logo.png" alt="Wall Street Club Logo"
                    style="width: 100%; height: 100%; object-fit: contain;">
            </div>
            <div class="logo-text">
                <h1>Wall Street Club</h1>
                <span>News Analyser • BITS Pilani</span>
            </div>
        </div>
        <nav class="nav-links">
            <a href="https://www.wallstreetbitsp.org/">Home</a>
            <a href="https://www.wallstreetbitsp.org/about">About</a>
            <a href="https://www.wallstreetbitsp.org/members">Members</a>
            <a href="https://www.wallstreetbitsp.org/newsletter">More</a>
        </nav>
        <div class="status-badge">
            <span class="status-dot"></span>
            <span id="statusText">Ready</span>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <!-- Hero Section -->
        <div class="hero">
            <h2>Market Sentiment Intelligence</h2>
            <p>Real-time analysis of <span class="highlight">10+ news sources</span> including Zerodha Pulse, Google
                Trends, and major financial outlets.</p>
        </div>

        <!-- Control Bar -->
        <div class="control-bar">
            <button class="btn btn-primary" id="runAnalysis">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z" />
                </svg>
                Run Live Analysis
            </button>
        </div>

        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value" id="statHeadlines">--</div>
                <div class="stat-label">Headlines</div>
            </div>
            <div class="stat-card">
                <div class="stat-value stat-positive" id="statSentiment">--</div>
                <div class="stat-label">Sentiment</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statRegime">--</div>
                <div class="stat-label">Regime</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statTime">--</div>
                <div class="stat-label">Updated</div>
            </div>
        </div>

        <!-- AI Summary Card -->
        <div class="card ai-summary-card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <span class="card-title">Market Intelligence Brief</span>
            </div>
            <div class="card-body">
                <p id="aiSummary" style="font-size: 1.1rem; line-height: 1.6; color: var(--text-primary);">
                    Run analysis to generate AI-powered market summary...
                </p>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Sector Table -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Sector Analysis</span>
                    <span class="regime-badge regime-neutral" id="regimeBadge">NEUTRAL</span>
                </div>
                <div class="card-body" id="sectorTableContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="card recommendations-card">
                <div class="card-header">
                    <span class="card-title">Recommendations</span>
                </div>
                <div class="card-body">
                    <div class="rec-section">
                        <div class="rec-title">Long Positions</div>
                        <div class="rec-list" id="longList"><span style="color: var(--text-muted)">--</span></div>
                    </div>
                    <div class="rec-section">
                        <div class="rec-title">Short Positions</div>
                        <div class="rec-list" id="shortList"><span style="color: var(--text-muted)">--</span></div>
                    </div>
                    <div class="rec-section">
                        <div class="rec-title">High Conviction</div>
                        <div class="rec-list" id="highConvictionList"><span style="color: var(--text-muted)">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Row -->
        <div class="main-grid" style="margin-top: 1.5rem;">
            <!-- Top Stocks (PRIMARY - LEFT) -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Top Active Stocks</span>
                </div>
                <div class="card-body">
                    <div id="topStocksList" style="min-height: 200px;">
                        <div style="padding: 1rem; text-align: center; color: var(--text-muted);">Run analysis to see
                            data</div>
                    </div>
                </div>
            </div>

            <!-- News Timeline (SECONDARY - RIGHT) -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Trending Topics</span>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div id="newsTimeline" class="news-timeline">
                        <div style="padding: 1rem; text-align: center; color: var(--text-muted);">Run analysis to see
                            headlines</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sector Heatmap & News Timeline Row -->
        <div class="main-grid" style="margin-top: 1.5rem;">
            <!-- Sector Heatmap -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Sector Heatmap</span>
                </div>
                <div class="card-body">
                    <div id="sectorHeatmap" class="heatmap-grid">
                        <div style="text-align: center; color: var(--text-muted);">Run analysis to see heatmap</div>
                    </div>
                </div>
            </div>

            <!-- Word Cloud (Bottom) -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Market Keywords</span>
                </div>
                <div class="card-body">
                    <div id="wordCloudContainer" class="word-cloud">
                        <div style="text-align: center; color: var(--text-muted); width: 100%;">Run analysis to see data
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>Wall Street Club • BITS Pilani • <a href="#">Read our Wall Street Pulse</a></p>
        <p style="margin-top: 0.5rem;">Powered by live RSS feeds, Zerodha Pulse, and Google Trends</p>
    </div>

    <script>
        const API_BASE = '';
        const runBtn = document.getElementById('runAnalysis');
        const statusText = document.getElementById('statusText');
        const sectorTableContainer = document.getElementById('sectorTableContainer');
        let autoRefreshInterval;

        // Run Analysis (Live)
        async function runLiveAnalysis() {
            runBtn.disabled = true;
            statusText.textContent = 'Analysing...';
            sectorTableContainer.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            try {
                const response = await fetch(`${API_BASE}/api/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ max_headlines: 100, max_age_hours: 24 })
                });
                if (!response.ok) throw new Error('Analysis failed');
                const data = await response.json();
                updateDashboard(data);
                statusText.textContent = `Live • ${data.headlines_analyzed} headlines`;
            } catch (error) {
                console.error('Live analysis failed:', error);
                statusText.textContent = 'Analysis Failed';
                sectorTableContainer.innerHTML = '<p style="color: var(--accent-red); text-align: center;">Analysis failed. Please ensure the backend is running.</p>';
            } finally {
                runBtn.disabled = false;
            }
        }

        runBtn.addEventListener('click', runLiveAnalysis);

        // Update Dashboard
        function updateDashboard(data) {
            document.getElementById('statHeadlines').textContent = data.headlines_analyzed || '--';

            const sentiment = data.effective_sentiment || 0;
            const sentimentEl = document.getElementById('statSentiment');
            sentimentEl.textContent = sentiment >= 0 ? `+${sentiment.toFixed(2)}` : sentiment.toFixed(2);
            sentimentEl.className = sentiment >= 0 ? 'stat-value stat-positive' : 'stat-value stat-negative';

            document.getElementById('statRegime').textContent = (data.regime || 'neutral').toUpperCase();
            document.getElementById('statTime').textContent = new Date().toLocaleTimeString();

            const regimeBadge = document.getElementById('regimeBadge');
            regimeBadge.textContent = (data.regime || 'neutral').toUpperCase();
            regimeBadge.className = `regime-badge regime-${data.regime || 'neutral'}`;

            updateSectorTable(data.sector_signals || []);
            updateRecommendations(data.long_sectors || [], data.short_sectors || [], data.high_conviction || []);
            updateTopStocks(data.top_stocks || []);
            updateWordCloud(data.word_cloud || []);

            // New v4.0 features
            updateAiSummary(data.ai_summary || '');
            updateHeatmap(data.sector_signals || []);
            updateNewsTimeline(data.headlines || []);
        }

        // Update Top Stocks with Industry & Price
        function updateTopStocks(stocks) {
            const container = document.getElementById('topStocksList');
            if (!stocks.length) {
                container.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-muted);">No stock mentions found</div>';
                return;
            }

            // Industry mapping for context
            const stockIndustries = {
                'TCS': 'IT Services', 'INFY': 'IT Services', 'WIPRO': 'IT Services',
                'RELIANCE': 'Energy/Retail', 'ADANIENT': 'Diversified',
                'HDFCBANK': 'Banking', 'ICICIBANK': 'Banking', 'SBIN': 'PSU Bank', 'KOTAKBANK': 'Banking',
                'TATAMOTORS': 'Auto', 'MARUTI': 'Auto', 'M&M': 'Auto',
                'ITC': 'FMCG', 'HINDUNILVR': 'FMCG',
                'LT': 'Infra', 'TITAN': 'Consumer',
                'NIFTY50': 'Index', 'BANKNIFTY': 'Index', 'SENSEX': 'Index',
                'GOLD': 'Commodity', 'USDINR': 'Forex', 'CRUDEOIL': 'Commodity'
            };

            let html = '';
            stocks.forEach(s => {
                const hasPrice = s.price !== null && s.price !== undefined;
                const changePct = s.change_pct || 0;
                const changeColor = changePct >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                const changeSign = changePct >= 0 ? '+' : '';
                const industry = stockIndustries[s.symbol] || 'Market';

                // Industry badge style
                const indColor = 'var(--text-muted)';

                html += `
                    <div class="stock-item" style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0;">
                        <div class="stock-info">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="stock-symbol" style="font-weight: 700; font-size: 1rem;">${s.symbol}</span>
                                <span style="font-size: 0.7rem; background: rgba(255,255,255,0.05); padding: 2px 6px; border-radius: 4px; color: ${indColor}; text-transform: uppercase;">${industry}</span>
                            </div>
                            <span class="stock-name" style="font-size: 0.85rem; opacity: 0.7;">${s.name}</span>
                        </div>
                        <div class="stock-metrics" style="text-align: right;">
                            ${hasPrice ? `
                                <div style="font-weight: 600; font-size: 1.1rem; letter-spacing: 0.5px;">₹${s.price.toLocaleString()}</div>
                                <div style="color: ${changeColor}; font-size: 0.85rem; font-weight: 500;">
                                    ${changeSign}${changePct}%
                                    <span style="font-size: 0.8em;">${changePct >= 0 ? '▲' : '▼'}</span>
                                </div>
                            ` : `
                                <div style="font-weight: 600; font-size: 1rem;">${s.mentions}</div>
                                <span style="color: var(--text-muted); font-size: 0.75rem;">mentions</span>
                            `}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function updateWordCloud(words) {
            const container = document.getElementById('wordCloudContainer');
            if (!words.length) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-muted);">No trends found</div>';
                return;
            }

            // Shuffle words for better visual distribution
            const shuffled = words.sort(() => 0.5 - Math.random());

            // Vibrant palette
            const colors = [
                '#38B2AC', // Teal
                '#4299E1', // Blue
                '#9F7AEA', // Purple
                '#F687B3', // Pink
                '#D69E2E', // Gold
                '#48BB78', // Green
                '#E2E8F0', // White/Grey
            ];

            container.innerHTML = shuffled.map(w => {
                const size = 1.5 + (w.value / 25); // Map 20-100 to ~2.3rem - 5.5rem (MUCH BIGGER)
                const color = colors[Math.floor(Math.random() * colors.length)];
                const opacity = 0.85 + (w.value / 200); // 0.9 to 1.0 (more visible)

                return `<span class="cloud-tag" style="
                    font-size: ${Math.min(size, 4.5)}rem; 
                    color: ${color}; 
                    opacity: ${opacity};
                    font-weight: ${w.value > 50 ? 700 : 600}
                ">${w.text}</span>`;
            }).join('');
        }

        // Update AI Summary
        function updateAiSummary(summary) {
            const el = document.getElementById('aiSummary');
            if (summary) {
                el.textContent = summary;
            } else {
                el.textContent = 'Unable to generate summary. Run analysis to retry.';
            }
        }

        // Update Sector Heatmap
        function updateHeatmap(signals) {
            const container = document.getElementById('sectorHeatmap');
            if (!signals || !signals.length) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-muted);">No sector data</div>';
                return;
            }

            container.innerHTML = signals.map(s => {
                const sentiment = s.sentiment || 0;

                // Use CSS gradient classes
                let colorClass;
                if (sentiment > 0.1) colorClass = 'heatmap-strong-bull';
                else if (sentiment > 0.02) colorClass = 'heatmap-bull';
                else if (sentiment < -0.1) colorClass = 'heatmap-strong-bear';
                else if (sentiment < -0.02) colorClass = 'heatmap-bear';
                else colorClass = 'heatmap-neutral';

                const sentStr = sentiment >= 0 ? `+${sentiment.toFixed(2)}` : sentiment.toFixed(2);

                return `<div class="heatmap-cell ${colorClass}">
                    <div class="sector-name">${s.sector}</div>
                    <div class="sentiment-value">${sentStr}</div>
                </div>`;
            }).join('');
        }

        // Update News Timeline
        function updateNewsTimeline(headlines) {
            const container = document.getElementById('newsTimeline');
            if (!headlines || !headlines.length) {
                container.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-muted);">No headlines available</div>';
                return;
            }

            container.innerHTML = headlines.map(h => {
                const sentClass = h.sentiment_label || 'neutral';
                const sentStr = h.sentiment >= 0 ? `+${h.sentiment.toFixed(2)}` : h.sentiment.toFixed(2);

                return `<div class="news-item">
                    <div class="news-text">${h.text}</div>
                    <div class="news-meta">
                        <span>${h.source}</span>
                        <span class="news-sentiment ${sentClass}">${sentStr}</span>
                    </div>
                </div>`;
            }).join('');
        }

        // Update Sector Table
        function updateSectorTable(signals) {
            if (!signals.length) {
                sectorTableContainer.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No data available</p>';
                return;
            }

            signals.sort((a, b) => Math.abs(b.trinity_score) - Math.abs(a.trinity_score));

            let html = `<table class="sector-table"><thead><tr>
                <th>Sector</th><th>Sentiment</th><th>Score</th><th>Signal</th><th>Conviction</th>
            </tr></thead><tbody>`;

            signals.forEach(s => {
                const scoreColor = s.trinity_score >= 0 ? 'positive' : 'negative';
                const scoreWidth = Math.min(100, Math.abs(s.trinity_score) * 100);
                const signalClass = s.recommendation.includes('long') ? 'long' : s.recommendation.includes('short') ? 'short' : 'hold';
                const level = { high: 3, medium: 2, low: 1 }[s.conviction] || 1;
                const dots = [0, 1, 2].map(i => `<span class="conviction-dot ${i < level ? 'active' : ''}"></span>`).join('');

                html += `<tr>
                    <td><span class="sector-name">${s.sector.toUpperCase()}</span></td>
                    <td style="color: ${s.sentiment >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                        ${s.sentiment >= 0 ? '+' : ''}${s.sentiment.toFixed(2)}
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="color: ${s.trinity_score >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}; font-weight: 600; min-width: 45px;">
                                ${s.trinity_score >= 0 ? '+' : ''}${s.trinity_score.toFixed(2)}
                            </span>
                            <div class="score-bar"><div class="score-fill ${scoreColor}" style="width: ${scoreWidth}%"></div></div>
                        </div>
                    </td>
                    <td><span class="signal-pill signal-${signalClass}">${s.recommendation.replace('_', ' ').toUpperCase()}</span></td>
                    <td><div class="conviction">${dots}</div></td>
                </tr>`;
            });

            html += '</tbody></table>';
            sectorTableContainer.innerHTML = html;
        }

        // Update Recommendations
        function updateRecommendations(longs, shorts, highConv) {
            document.getElementById('longList').innerHTML = longs.length ? longs.map(s => `<span class="rec-chip long">${s.toUpperCase()}</span>`).join('') : '<span style="color: var(--text-muted)">None</span>';
            document.getElementById('shortList').innerHTML = shorts.length ? shorts.map(s => `<span class="rec-chip short">${s.toUpperCase()}</span>`).join('') : '<span style="color: var(--text-muted)">None</span>';
            document.getElementById('highConvictionList').innerHTML = highConv.length ? highConv.map(s => `<span class="rec-chip high">${s.toUpperCase()}</span>`).join('') : '<span style="color: var(--text-muted)">None</span>';
        }

        // Start auto-refresh every 5 minutes
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                console.log('Auto-refreshing...');
                runLiveAnalysis();
            }, 5 * 60 * 1000);
        }

        // On page load: Run live analysis
        document.addEventListener('DOMContentLoaded', () => {
            runLiveAnalysis();
            startAutoRefresh();
        });
    </script>
</body>

</html>